(function(a){var b=a.extend({productTypeSelector:"#product-type",ticketTogglerSelector:"input#_ticket",ticketPanels:".show_if_ticket",ticketFieldsSelector:".ticket_fields",productDataMetaBoxSelector:"#woocommerce-product-data",insertFieldSelector:"a.insert",deleteFieldSelector:"a.delete",fieldLabelSelector:".field_label input",fieldTypeSelector:".field_type select",ticketFields:[],labelVariablesInfoSelector:".ticket-label-variables-info",labelVariablesSelector:".ticket-label-variables",ticketLinkVarSelector:".ticket-link-var",ticketTokenVarSelector:".ticket-token-var",ticketPostVarsSelector:".ticket-post-vars"},wcBoxOfficeParams);b.init=function(){b.populateTicketFields(),b.bindEvents(),b.setDefaultFieldsIfEmpty(),b.setDefaultPrintContentIfEmpty(),b.setDefaultEmailContentIfEmpty()},b.bindEvents=function(){a(b.productTypeSelector).on("change",b.maybeUncheckTicket).trigger("change"),a(b.ticketTogglerSelector).on("change",b.toggleTicketPanels).trigger("change"),a(b.productDataMetaBoxSelector).on("click",b.ticketFieldsSelector+" "+b.insertFieldSelector,b.insertField),a(b.productDataMetaBoxSelector).on("click",b.ticketFieldsSelector+" "+b.deleteFieldSelector,b.deleteField),a(b.productDataMetaBoxSelector).on("change",b.fieldTypeSelector,b.fieldTypeChange),a(b.ticketFieldsSelector).on("change",b.fieldLabelSelector,b.populateTicketFields),a(b.ticketFieldsSelector).on("row:inserted",b.populateTicketFields),a(b.ticketFieldsSelector).on("row:deleted",b.populateTicketFields),a(b.labelVariablesSelector).on("click","a",b.insertLabelToEditor),a(b.ticketLinkVarSelector).on("click","a",b.insertLabelToEditor),a(b.ticketTokenVarSelector).on("click","a",b.insertLabelToEditor),a(b.ticketPostVarsSelector).on("click","a",b.insertLabelToEditor)},b.maybeUncheckTicket=function(c){var d=a(b.ticketTogglerSelector);if(d.length){var e=d.closest("label").attr("class").trim().split(" "),f=e.filter(function(a){return a.startsWith("hide_if_")}).map(function(a){return a.substring(8)}),g=a(c.target).val();0<=a.inArray(g,f)&&d.removeAttr("checked").trigger("change")}},b.toggleTicketPanels=function(c){var d=a(c.target).is(":checked");a(b.ticketPanels).toggle(d)},b.insertField=function(){var c=a(this).data("row");return a(this).closest(b.ticketFieldsSelector).find("tbody").append(c),a(b.ticketFieldsSelector).trigger("row:inserted"),!1},b.deleteField=function(){return a(this).closest("tr").remove(),a(b.ticketFieldsSelector).trigger("row:deleted"),!1},b.fieldTypeChange=function(b){var c=a(b.target),d=c.val();return"select"===d||"radio"===d||"checkbox"===d?(c.closest("tr").find(".field_options textarea").show(),c.closest("tr").find(".field_options .email-options").hide()):"email"===d?(c.closest("tr").find(".field_options textarea").hide(),c.closest("tr").find(".field_options .email-options").show()):(c.closest("tr").find(".field_options textarea").hide(),c.closest("tr").find(".field_options .email-options").hide()),!1},b.populateTicketFields=function(){var c=a(b.fieldLabelSelector,b.ticketFieldsSelector);b.ticketFields=[],c.each(function(){b.ticketFields.push(this.value)}),b.updateLabelVariablesInfo()},b.updateLabelVariablesInfo=function(){b.ticketFields.length?(a(b.labelVariablesSelector).html(""),a.each(b.ticketFields,function(c,d){a(b.labelVariablesSelector).append("<a href=\"#\"><code>{"+d+"}</code></a>")}),a(b.labelVariablesInfoSelector).show()):a(b.labelVariablesInfoSelector).hide()},b.insertLabelToEditor=function(){var b,c=a(this).closest(".woocommerce_options_panel"),d=a(this).text();switch(c.attr("id")){case"ticket_content_data":b=tinyMCE.get("ticket-content-editor");break;case"ticket_email_data":b=tinyMCE.get("ticket-email-editor");}return b.insertContent(d),!1},b.setDefaultFieldsIfEmpty=function(){if(!b.ticketFields.length){var c=["First Name","Last Name","Email"],d=["first_name","last_name","email"];a(b.insertFieldSelector,b.ticketFieldsSelector).trigger("click"),a(b.insertFieldSelector,b.ticketFieldsSelector).trigger("click"),a(b.insertFieldSelector,b.ticketFieldsSelector).trigger("click"),a("tbody tr",b.ticketFieldsSelector).each(function(e){a(b.fieldLabelSelector,this).val(c[e]).trigger("change"),a(b.fieldTypeSelector,this).val(d[e]).trigger("change")})}},b.setDefaultPrintContentIfEmpty=function(){b._setTinyMCEDefaultContent("ticket-content-editor",b.defaultPrintContent)},b.setDefaultEmailContentIfEmpty=function(){b._setTinyMCEDefaultContent("ticket-email-editor",b.defaultEmailContent)},b._setTinyMCEDefaultContent=function(b,c){var d=a("#"+b),e="";d&&(e=d.val(),!e&&d.val(c))},a(b.init)})(jQuery);